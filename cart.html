<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="api-base" content="" />
    <script>
      (function(){
        try { var m = document.querySelector('meta[name="api-base"]'); if (m && m.content) window.API_BASE = m.content.replace(/\/+$/, ''); else window.API_BASE = ''; } catch(e){ window.API_BASE = ''; }
      })();
    </script>
    <title>Cart - iShop</title>
    <link rel="stylesheet" href="style.css" />
    <script src="script.js" defer></script>
  </head>
  <body>
    <header class="header">
      <div class="logo">iShop</div>
      <nav>
        <a class="btn" href="/products.html">Products</a>
        <a class="btn" href="/cart.html">Cart <span id="cart-count" class="cart-badge">0</span></a>
      </nav>
    </header>

    <main class="main-content">
      <section class="cart">
        <h2>Your Cart</h2>
        <div id="cart-contents">
          <!-- Cart content will be loaded by script.js (remote or local fallback) -->
        </div>
        <button class="btn" id="checkout-btn">Checkout</button>
      </section>
    </main>

    <script>
      // Use helpers provided by script.js to render cart page
      async function renderCartPage() {
        const items = await window.getCartItems();
        const container = document.getElementById('cart-contents');
        if (!items.length) {
          container.innerHTML = '<p>Your cart is empty.</p>';
          return;
        }
        container.innerHTML = '<ul>' + items.map(i => `<li>${i.product.name} x${i.quantity} - $${(i.product.price * i.quantity).toFixed(2)} <button data-id="${i.id}" class="btn remove-item">Remove</button></li>`).join('') + '</ul>';
        container.querySelectorAll('.remove-item').forEach(btn => btn.addEventListener('click', async (e) => {
          const id = parseInt(e.currentTarget.getAttribute('data-id'), 10);
          await window.removeCartItem(id);
          renderCartPage();
        }));
      }

      document.addEventListener('DOMContentLoaded', () => {
        renderCartPage();
        document.getElementById('checkout-btn').addEventListener('click', () => {
          if (confirm('Proceed to checkout? This will clear your cart in this demo.')) {
            window.clearCart();
            renderCartPage();
            alert('Thank you â€” this is a demo checkout.');
          }
        });
        // update header badge
        window.updateCartBadge();
      });
    </script>
  </body>
</html>
